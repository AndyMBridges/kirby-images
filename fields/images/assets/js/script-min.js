!function($){$.fn.images=function(){return this.each(function(){function e(){s.find(".add").removeClass("over"),s.find(".images-item").removeClass("over")}function i(){s.find(".images-item.selected").length?s.find(".imagesgrid").addClass("filled"):s.find(".imagesgrid").removeClass("filled")}function a(){s.find("input.images").val("").trigger("change"),s.find(".images-item.selected").length>1?(filenames=new Array,s.find(".images-item.selected").each(function(){filenames.push($(this).data("image"))}),filenames="- "+filenames.join("\n- "),s.find("input.images").val(filenames).trigger("change")):s.find("input.images").val(s.find(".images-item.selected").data("image")).trigger("change"),s.closest("form").trigger("keep")}function t(t){s.find(".images-item[data-image='"+t+"']").insertBefore(s.find(".add")).addClass("selected"),i(),s.find(".images-add-button select option[data-filename='"+t+"']").attr("disabled","disabled"),a(),e()}function d(t){s.find(".images-item[data-image='"+t+"']").removeClass("selected"),s.find(".images-add-button select option[data-filename='"+t+"']").removeAttr("disabled"),i(),e(),a()}var s=$(this),n="images";if(s.data("images"))return!0;s.data("images",!0),i(),s.find(".images-item .btn.remove").on("click",function(){if(!$(this).is(".ui-sortable-helper .btn")){d($(this).closest(".images-item").data("image"))}return!1}),s.find(".images-add-button select").on("change",function(e){t($(this).find("option:selected").text()),$(this).val($(this).find("option:first").val())});var l=s.find(".imagesgrid"),r=l.find(".sortable"),m=l.find(".images-item"),f=l.data("api");r.find(".images-item").length>1&&r.sortable({tolerance:"pointer",revert:100,handle:"figure",items:".selected",update:function(){a()}}).disableSelection(),s.find(".field-content").droppable({tolerance:"pointer",hoverClass:"over",accept:function(e){return!!$(".sidebar").has(e).length||(!($(this).has(e).length||!e.hasClass("grid-item"))||void 0)},drop:function(e,i){s.find(".add").removeClass("over"),s.find(".images-item").removeClass("over");var a=i.draggable.data("helper");i.draggable.hasClass("grid-item")&&(otherField=i.draggable.closest(".field-with-images"),otherField.find(".images-add-button select option[data-filename='"+a+"']").removeAttr("disabled"),otherField.find(".selected").length<=2&&otherField.find(".imagesgrid").removeClass("filled"),i.draggable.removeClass("selected"),otherField.find("input.images").val(""),otherField.find(".images-item.selected").length>1?(filenames=new Array,otherField.find(".images-item.selected").each(function(){filenames.push($(this).data("image"))}),filenames="- "+filenames.join("\n- "),otherField.find("input.images").val(filenames)):otherField.find("input.images").val(otherField.find(".images-item.selected").data("image")),otherField.closest("form").trigger("keep")),t(a)},over:function(e,i){s.find(".imagesgrid").addClass("filled");var a=s.find(".images-item[data-image='"+i.draggable.data("helper")+"']");if(a.hasClass("selected"))a.addClass("over");else{var t=s.find(".images-item.selected figure");if(t.length)var d=t.height()-4;else{var n=s.find(".images-item").first();n.addClass("selected");var d=n.find("figure").height()-4;n.removeClass("selected")}s.find(".add .inner").height(d),s.find(".add").addClass("over")}},out:function(a,t){e(),i()}})})}}(jQuery);