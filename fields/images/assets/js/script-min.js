!function($){$.fn.images=function(){return this.each(function(){function e(){a.find(".grid-item.selected").length?a.find(".empty").hide():a.find(".empty").show(),a.find(".add").removeClass("over"),a.find(".grid-item").removeClass("over")}function i(){a.find("input.images").val(""),a.find(".grid-item.selected").length>1?(filenames=new Array,a.find(".grid-item.selected").each(function(){filenames.push($(this).data("image"))}),a.find("input.images").val(filenames.join(","))):a.find("input.images").val(a.find(".grid-item.selected").data("image"))}function d(e){a.find(".grid-item[data-image='"+e+"']").insertBefore(a.find(".add")).addClass("selected"),a.find(".empty").hide(),a.find(".images-add-button select option[data-filename='"+e+"']").attr("disabled","disabled"),i()}function t(d){a.find(".grid-item[data-image='"+d+"']").removeClass("selected"),a.find(".images-add-button select option[data-filename='"+d+"']").removeAttr("disabled"),e(),i()}var a=$(this),n="images";if(a.data("images"))return!0;a.data("images",!0),e(),a.find(".grid-item .btn.remove").on("click",function(){return t($(this).closest(".grid-item").data("image")),!1}),a.find(".images-add-button select").on("change",function(e){d($(this).find("option:selected").text()),$(this).val($(this).find("option:first").val())});var s=a.find(".files"),r=s.find(".sortable"),f=s.find(".grid-item"),l=s.data("api");r.find(".grid-item").length>1&&r.sortable({tolerance:"pointer",revert:100,handle:"figure",items:".selected",update:function(){i()}}).disableSelection(),a.find(".field-content").droppable({tolerance:"pointer",hoverClass:"over",accept:$(".sidebar .draggable-file"),drop:function(e,i){a.find(".add").removeClass("over"),a.find(".grid-item").removeClass("over"),d(i.draggable.data("helper"))},over:function(e,i){a.find(".empty").hide();var d=a.find(".grid-item[data-image='"+i.draggable.data("helper")+"']");if(d.hasClass("selected"))d.addClass("over");else{var t=a.find(".grid-item.selected figure");if(t.length)var n=t.height()-4;else{var s=a.find(".grid-item").first();s.addClass("selected");var n=s.find("figure").height()-4;s.removeClass("selected")}a.find(".add .inner").height(n),a.find(".add").addClass("over")}},out:function(i,d){e()}})})}}(jQuery);